{% extends 'base.html' %}
{% block panel_center_content %}
<div class="max-w-7xl mx-auto">
  <h2 class="text-2xl md:text-3xl font-bold text-slate-800 mb-2">Alumnos en Riesgo</h2>
  <p class="text-slate-600 mb-6">Curso: <strong class="text-indigo-700">{{ course }}</strong> · Nivel: <strong class="capitalize">{{ level }}</strong></p>

  {% if students %}
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 [grid-auto-flow:dense]">
    {% for s in students %}
      <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden hover:shadow-xl transition-shadow duration-300">
        <div class="p-6">
          <div class="flex items-center justify-between mb-3">
            <div class="text-slate-800 font-semibold truncate">{{ s.name }}</div>
            <div class="text-sm font-mono px-2 py-1 rounded bg-slate-100 text-slate-700">Score: {{ s.score }}</div>
          </div>
          {% if model_preds and model_preds.get(s.name) %}
          <div class="mb-3">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold"
                  style="background-color:#eef2ff;color:#4f46e5;">
              Predicción modelo: {{ model_preds.get(s.name).predicted_level|default('N/A') }}
              {% if model_preds.get(s.name).prob_high is not none %}
            · Probabilidad de Riesgo: {{ (model_preds.get(s.name).prob_high * 100)|round(1) }}%
          {% endif %}
            </span>
          </div>
          {% endif %}
          {% if s.reasons %}
            <p class="text-xs text-slate-500 uppercase mb-2">Razones</p>
            <ul class="text-sm text-slate-700 mb-4">
              {% for r in s.reasons[:3] %}
              <li>• {{ r|replace('_',' ') }}</li>
              {% endfor %}
            </ul>
          {% endif %}
          <div class="flex items-center gap-2">
            <a href="{{ url_for('main.generar_reporte_360', tipo_entidad='alumno', valor_codificado=s.name) }}" class="inline-flex items-center bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-semibold px-3 py-2 rounded-lg text-sm">
              <i class="fas fa-file-invoice mr-2"></i>
              <span>Reporte 360</span>
            </a>
            <a href="{{ url_for('main.ver_sugerencias_alumno', valor_codificado=s.name) }}" class="inline-flex items-center bg-violet-50 hover:bg-violet-100 text-violet-700 font-semibold px-3 py-2 rounded-lg text-sm">
              <i class="fas fa-lightbulb mr-2"></i>
              <span>Ver Sugerencias</span>
            </a>
            <a href="{{ url_for('main.detalle_entidad', tipo_entidad='alumno', valor_codificado=s.name) }}" class="inline-flex items-center bg-green-50 hover:bg-green-100 text-green-700 font-semibold px-3 py-2 rounded-lg text-sm">
              <i class="fas fa-user mr-2"></i>
              <span>Dashboard Estudiante</span>
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="bg-white p-8 rounded-xl shadow-lg border border-slate-200 text-center">
      <p class="text-slate-500 italic">No hay alumnos en este nivel de riesgo para el curso seleccionado.</p>
    </div>
  {% endif %}

  <div class="mt-6">
    <a href="{{ url_for('main.riesgos') }}" class="text-indigo-600 hover:text-indigo-800">← Volver al Panel de Riesgos</a>
  </div>
</div>
{% endblock %}
