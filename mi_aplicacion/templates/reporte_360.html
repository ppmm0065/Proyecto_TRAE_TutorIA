{% extends 'base.html' %}

{% block title %}
    {{ page_title|default('Reporte 360') }} - {{ nombre_entidad }}
{% endblock %}

{% block head_extra %}
<style>
    /* Estilos para personalizar la salida del reporte generado por IA */
    .ia-report-content h3 {
        font-size: 1.125rem; /* text-lg */
        font-weight: 700;
        color: #4338ca; /* indigo-700 */
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e0e7ff; /* indigo-100 */
    }
    .ia-report-content ul {
        list-style: none;
        padding-left: 0;
    }
    .ia-report-content li {
        position: relative;
        padding-left: 1.75rem; /* Espacio para el ícono */
        margin-bottom: 0.5rem;
        color: #374151; /* gray-700 */
    }
    .ia-report-content li::before {
        content: '\f00c'; /* check icon for strengths */
        font-family: 'Font Awesome 6 Free';
        font-weight: 900;
        position: absolute;
        left: 0;
        top: 2px;
        color: #16a34a; /* green-600 */
    }
    /* Iconos específicos para desafíos */
    .ia-report-content h3:first-of-type + ul li::before {
        content: '\f00c'; /* check icon */
        color: #16a34a; /* green-600 */
    }
    .ia-report-content h3:nth-of-type(2) + ul li::before {
        content: '\f071'; /* warning icon */
        color: #f59e0b; /* amber-500 */
    }
    .ia-report-content h3:nth-of-type(3) + ul li::before {
        content: '\f05a'; /* info icon */
        color: #3b82f6; /* blue-500 */
    }

    /* Ocultar de forma defensiva cualquier sección/elemento relacionado a Observaciones del Reporte 360
       que pudiera seguir presente por cacheo de plantillas o duplicados en el entorno. */
    #seccion-observaciones-reporte,
    #seccion-observaciones-anteriores,
    #form-agregar-observacion-reporte,
    #observacion-guardada-notificacion,
    #lista-observaciones-reporte {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
    }
</style>
{% endblock %}

{% block panel_left_content %}
    <h2 class="text-xl font-semibold text-slate-800 mb-2">Reporte 360</h2>
    <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200 mb-6">
        <p class="text-sm text-slate-600">Tipo de Entidad:</p>
        <p class="font-semibold text-indigo-700 break-words capitalize">{{ tipo_entidad }}</p>
        <p class="text-sm text-slate-600 mt-2">Nombre Entidad:</p>
        <p class="font-semibold text-indigo-700 break-words">{{ nombre_entidad }}</p>
        <p class="text-sm text-slate-600 mt-2">Archivo Origen:</p>
        <p class="font-semibold text-indigo-700 break-words">{{ filename }}</p>
        {% if reporte_360_id %}
        <p class="text-sm text-slate-600 mt-2">ID Reporte:</p>
        <p class="font-semibold text-indigo-700 break-words">#{{ reporte_360_id }}</p>
        {% endif %}
    </div>

    <hr class="my-6 border-slate-300">

    <h3 class="text-md font-semibold text-slate-700 mb-3">Acciones</h3>
    <ul class="space-y-2 text-sm">
        <li>
            <a href="{{ url_for('main.detalle_entidad', tipo=tipo_entidad, valor_codificado=nombre_entidad) }}" class="text-slate-600 hover:text-indigo-600 hover:font-semibold flex items-center">
                <i class="fas fa-arrow-left mr-2 w-4 text-center"></i> Volver al Detalle de {{ tipo_entidad|capitalize }}
            </a>
        </li>
        <li>
            <a href="{{ url_for('main.index') }}" class="text-slate-600 hover:text-indigo-600 hover:font-semibold flex items-center">
                <i class="fas fa-home mr-2 w-4 text-center"></i> Volver al Dashboard Principal
            </a>
        </li>
        {% if reporte_html and not reporte_html.startswith("Error:") %}
        <li>
            <a href="{{ url_for('main.descargar_reporte_360_html', tipo_entidad=tipo_entidad, valor_codificado=nombre_entidad) }}"
               class="mt-3 block w-full text-left bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2.5 px-4 rounded-lg transition duration-300 ease-in-out shadow-md hover:shadow-lg transform hover:scale-105">
                <i class="fas fa-file-code mr-2"></i> Descargar Reporte (HTML)
            </a>
        </li>
        <li>
            <a href="{{ url_for('main.generar_plan_intervencion', tipo_entidad=tipo_entidad, valor_codificado=nombre_entidad) }}"
               class="mt-3 block w-full text-left bg-green-600 hover:bg-green-700 text-white font-semibold py-2.5 px-4 rounded-lg transition duration-300 ease-in-out shadow-md hover:shadow-lg transform hover:scale-105">
                <i class="fas fa-clipboard-list-check mr-2"></i> Generar Plan de Intervención
            </a>
        </li>
        {% endif %}
    </ul>
{% endblock %}

{% block panel_center_content %}
<div class="flex flex-col h-full">
    
    {# --- INICIO: MODIFICACIÓN EN ESTE BLOQUE --- #}
    <div class="flex justify-between items-start mb-6">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold text-slate-800">
                Reporte 360: <span class="text-indigo-600">{{ nombre_entidad }}</span>
            </h1>
            {% if timestamp_generacion %}
            {# MODIFICADO: Se quitó .split(' ')[0] para mostrar la hora #}
            <p class="text-lg font-normal text-slate-500">
                ({{ tipo_entidad|capitalize }}) - Emitido el: {{ timestamp_generacion }}
            </p>
            {% else %}
            <p class="text-lg font-normal text-slate-500">
                ({{ tipo_entidad|capitalize }})
            </p>
            {% endif %}
        </div>
    </div>
    {# --- FIN: MODIFICACIÓN --- #}

    {% if reporte_html %}
        {% if reporte_html.startswith("Error:") %}
            <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
                <p class="font-bold">Error al generar el reporte</p>
                <p>{{ reporte_html|safe }}</p>
            </div>
        {% else %}
            <div class="bg-white p-6 rounded-lg shadow-xl border border-slate-200 ia-report-content max-w-none mb-8">
                {{ reporte_html|safe }}
            </div>

            {# Se elimina la sección de registro y listado de observaciones del Reporte 360, según requerimiento #}
        {% endif %}
    {% else %}
        <div class="bg-yellow-50 border-l-4 border-yellow-400 text-yellow-700 p-4 mb-6" role="alert">
            <p class="font-bold">Información no disponible</p>
            <p>No se pudo generar el contenido del reporte.</p>
        </div>
    {% endif %}
</div>
{% endblock panel_center_content %}

{% block panel_right_content %}
    {{ super() }}
{% endblock panel_right_content %}

{% block scripts %}
    {{ super() }}
    <!-- Scripts de observaciones eliminados según requerimiento: no se registran ni muestran observaciones dentro del Reporte 360. -->
{% endblock scripts %}
